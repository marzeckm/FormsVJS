const ERROR_VALIDATORS_PATTERN="ValidatorFn have to be build in the following pattern: (abstractControl:AbstractControl) => {key:string : value:string} | null.",ERROR_VALIDATOR_CONTAIN_FN="Validators have to contain a function that returns either null (no Error) or an Object (Error)!",ERROR_CONTROL_STATE="The requested Control-State is not available.",ERROR_ONLY_ONE_ATTRIBUTE="You can only set one of these attributes per DOM-Element: formGroupName, formGroup, formControlName or formControl!",TYPE_OBJECT="object",TYPE_STRING="string",TYPE_ARRAY="Array",TYPE_FUNCTION="function",TYPE_FORMGROUP="FormGroup",TYPE_FORMCONTROL="FormControl",EMIT_EVENT="emitEvent",FORMCONTROL_NAME="formControlName",FORMGROUP_NAME="formGroupName",FORMCONTROL="formControl",FORMGROUP="formGroup",AbstractControlState={VALID:"VALID",INVALID:"INVALID",getName:function(){return"AbstractControlState"},VALUES:["VALID","INVALID"]},AbstractControlType={FORMGORUP:"FORMGROUP",FORMCONTROL:"FORMCONTROL",getName:function(){return"AbstractControlType"},VALUES:["FORMGROUP","FORMCONTROL"]},AbstractControl=function(){const t=inject(FormsService).generateUID(16),r=SimpleObservable(),o=SimpleObservable(),e={_constructName:"AbstractControl",parent:void 0,value:void 0,valueChanges:r,valid:!0,invalid:!1,state:AbstractControlState.VALID,statusChanges:o,touched:!1,errors:[],_uid:t,_validators:[],setValue:function(t){this.value=t,this.markAsTouched(),this.valueChanges.next(t),this.parent&&this.parent._refreshValue()},setState:function(t){if(this.touched=!0,!(AbstractControlState.VALUES.indexOf(t)>-1))throw Error(ERROR_CONTROL_STATE);this.state=t,this.statusChanges.next(t),this.valid=t===AbstractControlState.VALID,this.invalid=t===AbstractControlState.INVALID,this.parent&&this.parent._setFormGroupStatus(t)},setValidators:function(t){t.length?this._validators=t.map((function(t){ValidatorFn(t)})):t=[t],this._validators=t},addValidators:function(t){t.length?t.forEach((function(t){this._validators.push(ValidatorFn(t))})):t=[t],this._validators.concat(t)},markAsTouched:function(){this.touched=!0,this._checkValidity()},markAsUntouched:function(){this.touched=!1,this._checkValidity()},hasErrors:function(){return this.errors&&this.errors.length>0},setParent:function(t){this.parent=t},updateValueAndValidity:function(){this._checkValidity(),this.hasErrors()||this.setValue(this.value)},_checkValidity:function(){this.errors=[];const t=this;this._validators.forEach((function(r){const o=r(t);if(o&&"object"==typeof o)t.errors.push(o);else if(o)throw Error(ERROR_VALIDATORS_PATTERN)})),this._setErrosOnHtmlElements(),this.setState(this._isInvalid()?AbstractControlState.INVALID:AbstractControlState.VALID)},_setErrosOnHtmlElements:function(){const t=document.querySelectorAll(["[",this._constructName===TYPE_FORMGROUP?FORMGROUP:FORMCONTROL,'="',this._uid,'"]'].join("")),r=this;Object.keys(t).forEach((function(o){r.hasErrors()?(t[o].classList.add("error"),t[o].setAttribute("data-errors",JSON.stringify(r.errors))):(t[o].classList.remove("error"),t[o].removeAttribute("data-errors"))}))},_isInvalid:function(){return this.hasErrors()}};return e.setValue.bind(e),e.setState.bind(e),e},FormControl=function(){const t=ifExtends(AbstractControl,{});t._constructName=TYPE_FORMCONTROL;return inject(FormsService).addFormControl(t),t},FormGroup=function(t){const r=ifExtends(AbstractControl,{_constructName:TYPE_FORMGROUP,controls:{},_dataType:void 0,get:function(t){if("string"==typeof t)return this.controls[t];if("Array"===t.constructor){const r=t.shift();return t.length>0?this.get(t):this.controls[r]}},addControl:function(t,r,o){this.controls[t]=r,r.parent=this,!1!==o[EMIT_EVENT]?this._refreshValue():this.value[t]=r},removeControl:function(t,r){this.controls[t]=void 0,!1!==r[EMIT_EVENT]?this._refreshValue():this.value[t]=void 0},markAllAsTouched:function(){this.markAsTouched(),Object.keys(this.controls).forEach((function(r){t[r]._constructName===TYPE_FORMGROUP&&t[r].markAllAsTouched(),t[r].markAsTouched()}))},markAllAsUntouched:function(){this.markAsUntouched(),Object.keys(this.controls).forEach((function(r){t[r].constructName===TYPE_FORMGROUP&&t[r].markAllAsUntouched(),t[r].markAsUntouched()}))},_refreshValue:function(){const t={},r=this;Object.keys(this.controls).forEach((function(o){t[o]=r.controls[o].value})),this.setValue(this._dataType?this._dataType.deserialize(t):t)},_setFormGroupStatus:function(t){this.setState(this._getStatusFromChildren()?AbstractControlState.INVALID:t)},_isInvalid:function(){return this.hasErrors()||this._getStatusFromChildren()},_getStatusFromChildren:function(){return Object.keys(this.controls).map((function(r){return!t[r].valid})).filter(Boolean).length>0}});r.value={},Object.keys(t).forEach((function(o){[TYPE_FORMCONTROL,TYPE_FORMGROUP].indexOf(t[o]._constructName)>-1&&(r.controls[o]=t[o],t[o].parent=r)}));return inject(FormsService).addFormGroup(r),r},ValidatorFn=function(t){if("function"!=typeof t){if(t._constructName===ValidatorFn)return t;throw new Error(ERROR_VALIDATOR_CONTAIN_FN)}return{_constructName:"ValidatorFn",_fn:t,execute:function(){return this._fn()}}},SimpleObservable=function(){return{_constructName:"SimpleObservable",value:void 0,_fn:void 0,next:function(t){this.value=t,this._fn&&this._fn(t)},subscribe:function(t){this._fn=t,this.next.bind(this),this.next(this.value)}}},ifExtends=function(t,r){const o=t();return Object.keys(r).forEach((function(t){o[t]=r[t]})),o},inject=function(t){return void 0===window._singletons&&(window._singletons={}),void 0===window._singletons[t()._constructName]&&(window._singletons[t()._constructName]=t()),window._singletons[t()._constructName]},FormsService=function(){return{_constructName:"FormsService",_controls:{},init:function(t,r){t.setAttribute(FORMGROUP,r._uid);const o=t.querySelectorAll(["[",FORMCONTROL_NAME,"]"].join("")),e=this;Object.keys(o).forEach((function(t){e.getParentForm(o[t])}))},createFormGroup:function(t){const r={};return Object.keys(t).forEach((function(o){r[o]=t[o]})),new FormGroup(r)},createFormControl:function(){return new FormControl({})},addFormControl:function(t){this._controls[t._uid]=t},addFormGroup:function(t){this._controls[t._uid]=t},controlAvailable:function(t){return!!this._controls[t]},getParentForm:function(t){if(this._checkFormGroupIdentifierOnce(t))throw Error(ERROR_ONLY_ONE_ATTRIBUTE);for(;t&&1===t.nodeType;){if((t=t.parentNode).hasAttribute(FORMGROUP)){const r=this._controls[t.getAttribute(FORMGROUP)];return this._setFormControls(t,r),r}if(t.hasAttribute(FORMGROUP_NAME)){const r=this.getParentForm(t);return this._setFormControls(t,r),r}}return null},saveAction:function(t){const r=this.getParentForm(t);return r.markAllAsTouched(),r},generateUID:function(t){for(var r;!r||this.controlAvailable(r);)r=["@",this._generateRadomString("ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t)].join("");return r},getFormGroupResult:function(t,r){const o=this.getParentForm(t);return o.markAllAsTouched(),r&&(r.deserialize?o.setValue(r.deserialize(o.value)):r().deserialize&&o.setValue(r().deserialize(o.value))),o},_generateRadomString:function(t,r,o){o=o||"";for(var e=0;e<r;e++){const r=Math.floor(Math.random()*t.length);o+=t.charAt(r)}return o},_checkFormGroupIdentifierOnce:function(t){return[t.getAttribute(FORMGROUP),t.getAttribute(FORMGROUP_NAME),t.getAttribute(FORMCONTROL),t.getAttribute(FORMCONTROL_NAME)].map((function(t){return!!t||void 0})).length<=1},_setFormControls:function(t,r){const o=this;Object.keys(r.controls).forEach((function(e){const n=r.controls[e]._constructName,s=n===TYPE_FORMGROUP?AbstractControlType.FORMGORUP:AbstractControlType.FORMCONTROL,i=["[",n===TYPE_FORMGROUP?FORMGROUP_NAME:FORMCONTROL_NAME,"=",e,"]"].join("");o._prepareAbstractControl(t.querySelector(i),s,r.controls[e]._uid)}))},_prepareAbstractControl:function(t,r,o){t&&(t.setAttribute(r===AbstractControlType.FORMCONTROL?FORMCONTROL:FORMGROUP,o),t.removeAttribute(r===AbstractControlType.FORMCONTROL?FORMCONTROL_NAME:FORMGROUP_NAME),r===AbstractControlType.FORMCONTROL&&(t.oninput=function(t){inject(FormsService)._controls[t.target.getAttribute(FORMCONTROL)].setValue(t.target.value)}))}}};